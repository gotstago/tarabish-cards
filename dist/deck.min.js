"use strict";var Deck=function(){function n(n,e){var o=Date.now(),r=o+n,u=r+e,i={start:r,end:u};y.push(i),g||(g=!0,requestAnimationFrame(t));var c={start:function(n){return i.startcb=n,c},progress:function(n){return i.progresscb=n,c},end:function(n){return i.endcb=n,c}};return c}function t(){var n=Date.now();if(!y.length)return void(g=!1);for(var e,o=0;o<y.length;o++)if(e=y[o],!(n<e.start)){e.started||(e.started=!0,e.startcb&&e.startcb());var r=(n-e.start)/(e.end-e.start);e.progresscb&&e.progresscb(r<1?r:1),n>e.end&&(e.endcb&&e.endcb(),y.splice(o--,1))}requestAnimationFrame(t)}function e(n){if(void 0!==T[n])return T[n];if(void 0!==C[n])return T[n]=n,n;for(var t,e=n[0].toUpperCase()+n.slice(1),o=["webkit","moz","Moz","ms","o"],r=0,u=o.length;r<u;r++)if(t=o[r]+e,void 0!==C[t])return T[n]=t,t}function o(n,t,e){return void 0!==b||(b=r()),e=e||0,b?"translate3d("+n+", "+t+", "+e+")":"translate("+n+", "+t+")"}function r(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!1;var n=e("transform"),t=document.createElement("p");return document.body.appendChild(t),t.style[n]="translate3d(1px,1px,1px)",b=t.style[n],b=null!=b&&b.length&&"none"!==b,document.body.removeChild(t),b}function u(n){return document.createElement(n)}function i(t){function r(n){function t(n){k&&("mousemove"===n.type?(u.x=n.clientX,u.y=n.clientY):(u.x=n.touches[0].clientX,u.y=n.touches[0].clientY),y.style[h]=o(Math.round(M.x+u.x-r.x)+"px",Math.round(M.y+u.y-r.y)+"px")+(M.rot?" rotate("+M.rot+"deg)":""))}function e(n){w&&Date.now()-i<200&&M.setSide("front"===M.side?"back":"front"),"mouseup"===n.type?(s(window,"mousemove",t),s(window,"mouseup",e)):(s(window,"touchmove",t),s(window,"touchend",e)),k&&(M.x=M.x+u.x-r.x,M.y=M.y+u.y-r.y)}var r={},u={},i=Date.now();n.preventDefault(),"mousedown"===n.type?(r.x=u.x=n.clientX,r.y=u.y=n.clientY,a(window,"mousemove",t),a(window,"mouseup",e)):(r.x=u.x=n.touches[0].clientX,r.y=u.y=n.touches[0].clientY,a(window,"touchmove",t),a(window,"touchend",e)),k&&(y.style[h]=o(M.x+"px",M.y+"px")+(M.rot?" rotate("+M.rot+"deg)":""),y.style.zIndex=P++)}function i(n){n.appendChild(y),M.$root=n}function d(){M.$root&&M.$root.removeChild(y),M.$root=null}function f(n){"front"===n?("back"===M.side&&y.removeChild(x),M.side="front",y.appendChild(b),M.setRankSuit(M.rank,M.suit)):("front"===M.side&&y.removeChild(b),M.side="back",y.appendChild(x),y.setAttribute("class","card"))}var l,h=e("transform"),p=t%13+1,m=t/13|0,g=(52-t)/4,y=u("div"),b=u("div"),x=u("div"),k=!1,w=!1,M={i:t,rank:p,suit:m,pos:t,$el:y,mount:i,unmount:d,setSide:f},q=v.modules;b.classList.add("face"),x.classList.add("back"),y.style[h]=o(-g+"px",-g+"px"),M.x=-g,M.y=-g,M.z=g,M.rot=0,M.setSide("back"),a(y,"mousedown",r),a(y,"touchstart",r);for(l in q)!function(n){n.card&&n.card(M)}(q[l]);return M.animateTo=function(t){var e,r,u,i,c,a,s=t.delay,d=t.duration,f=t.x,l=void 0===f?M.x:f,p=t.y,m=void 0===p?M.y:p,v=t.rot,g=void 0===v?M.rot:v,b=t.ease,x=t.onStart,k=t.onProgress,w=t.onComplete;n(s,d).start(function(){e=M.x||0,r=M.y||0,u=M.rot||0,x&&x()}).progress(function(n){var t=O[b||"cubicInOut"](n);i=l-e,c=m-r,a=g-u,k&&k(n,t),M.x=e+i*t,M.y=r+c*t,M.rot=u+a*t,y.style[h]=o(M.x+"px",M.y+"px")+(a?"rotate("+M.rot+"deg)":"")}).end(function(){w&&w()})},M.setRankSuit=function(n,t){var e=c(t);y.setAttribute("class","card "+e+" rank"+n)},M.setRankSuit(p,m),M.enableDragging=function(){k||(k=!0,y.style.cursor="move")},M.enableFlipping=function(){w||(w=!0)},M.disableFlipping=function(){w&&(w=!1)},M.disableDragging=function(){k&&(k=!1,y.style.cursor="")},M}function c(n){return 0===n?"spades":1===n?"hearts":2===n?"clubs":3===n?"diamonds":"joker"}function a(n,t,e){n.addEventListener(t,e)}function s(n,t,e){n.removeEventListener(t,e)}function d(n){return(Math.round(Math.random())?-1:1)*n}function f(n){for(var t,e,o=n.length-1;o;o--)t=Math.random()*o|0,e=n[o],n[o]=n[t],n[t]=e;return n}function l(){return window.getComputedStyle(document.body).getPropertyValue("font-size").slice(0,-2)}function h(n){return n*Math.PI/180}function p(n){function t(n){return function(){var t=this,o=arguments;e(function(e){n.apply(t,r.concat.apply(e,o))})}}function e(n){n&&(u.push(n),1===u.length&&o())}function o(){u[0](function(n){if(n)throw n;u=u.slice(1),u.length&&o()})}var r=Array.prototype,u=[];return n.queue=e,n.queued=t,n}function m(n){function t(n,t,e){u[n]||(u[n]=[]),u[n].push({cb:t,ctx:e})}function e(n,t,e){u[n]||(u[n]=[]),u[n].push({cb:t,ctx:e,once:!0})}function o(n){var t=this,e=Array.prototype.slice(arguments,1);(u[n]||[]).filter(function(n){return n.cb.apply(t,e),!n.once})}function r(n,t){return n?t?void(u[n]=u[n].filter(function(n){return n.cb!==t})):void(u[n]=[]):void(u={})}n||(n={});var u={};return n.on=t,n.one=e,n.off=r,n.trigger=o,n}function v(n){function t(n){o=n,o.appendChild(a)}function e(){o.removeChild(a)}var o,r,c=new Array(n?55:52),a=u("div"),s=m({mount:t,unmount:e,cards:c,$el:a}),d=v.modules;p(s);for(r in d)!function(n){n.deck&&n.deck(s)}(d[r]);a.classList.add("deck");for(var f,l=c.length;l;l--)f=c[l-1]=i(l-1),f.setSide("back"),f.mount(a);return s}var g,y=[];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){setTimeout(n,0)});var b,x,k,w,M,q,S,C=document.createElement("p").style,T={},P=52,O={linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return n<.5?2*n*n:(4-2*n)*n-1},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return 1+--n*n*n*n*n},quintInOut:function(n){return n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n}},I={deck:function(n){function t(t,e){var o=n.cards.filter(function(n){return"front"===n.side}).length/n.cards.length;n.cards.forEach(function(n,t){n.setSide(e||(o>.5?"back":"front"))}),t()}n.flip=n.queued(t)}},A={deck:function(n){function t(t,e){var o=n.cards;o.sort(function(n,t){return e?n.i-t.i:t.i-n.i}),o.forEach(function(n,r){n.sort(r,o.length,function(n){n===o.length-1&&t()},e)})}n.sort=n.queued(t)},card:function(n){var t=n.$el;n.sort=function(e,o,r,u){var i=e/4,c=10*e;n.animateTo({delay:c,duration:400,x:-i,y:-150,rot:0,onComplete:function(){t.style.zIndex=e}}),n.animateTo({delay:c+500,duration:400,x:-i,y:-i,rot:0,onComplete:function(){r(e)}})}}},E={deck:function(n){function t(t){var e=n.cards;x=l(),f(e),e.forEach(function(n,o){n.pos=o,n.shuffle(function(n){n===e.length-1&&t()})})}n.shuffle=n.queued(t)},card:function(n){var t=n.$el;n.shuffle=function(e){var o=n.pos,r=o/4,u=2*o;n.animateTo({delay:u,duration:200,x:d(40*Math.random()+20)*x/16,y:-r,rot:0}),n.animateTo({delay:200+u,duration:200,x:-r,y:-r,rot:0,onStart:function(){t.style.zIndex=o},onComplete:function(){e(o)}})}}},z={deck:function(n){function t(n,t){w.length;r.start(!0).then(function(t){console.log("Got the final result: "+t),n()})}function e(n,t){console.log("test is "+t),n()}k=l(),w=n.cards;var o=w.length;console.log("cards length is "+o);var r=function(){function n(){return e(h[s]).then(t).then(t).then(t).catch(function(n){return d=n,console.log("bid is resolved"),Promise.resolve(n)})}function t(n){return f=h[s],console.log("bid is "+h[s]+", "+n),s=(s+1)%4,"pass"===n?(console.log("bid is not resolved"),e(h[s])):Promise.reject(n)}function e(n){return new Promise(function(t,e){var r=g[n];return r.cards.forEach(function(n){console.log("card is "+n.rank+" of "+n.suit)}),t(o(r.cards))})}function o(n){var t=[0,1,2,3].map(function(t){return[n.filter(function(n){return 0===n.suit}),n.filter(function(n){return 1===n.suit}),n.filter(function(n){return 2===n.suit}),n.filter(function(n){return 3===n.suit})].map(function(n){return n.reduce(function(n,e,o){return e.suit===t?n+m[e.rank.toString()].trump:n+m[e.rank.toString()].nonTrump},0)}).reduce(function(n,t){return n+t},0)}),e=t.reduce(function(n,t,e,o){return t>o[n]?e:n},0);return console.log(t),console.log(e),t[e]>34?p[e]:"pass"}function r(n){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],e=n*t,o=w.length,r=w.slice(o-v-e,o-v);console.log("dealing "+n+" cards "+t+" times from deck of "+o+"."),console.log("first to bid is "+h[s]),console.log("dealer is "+h[c]);for(var i=Promise.resolve(),a=0;a<t;a++){for(var d=0;d<n;d++)!function(n){var t=r.pop();console.log("cardsToDeal are "+r.length),function(e){i=i.then(function(){return u(e,t,n)})}(s)}(d);s=(s+1)%t,console.log("after incrementing, currentPosition is "+s)}return i}function u(n,t,e){return new Promise(function(e,o){var r=g[h[n]];console.log("position is "+r.nextPosition);var u=r.cards.length;console.log("handSize is "+u);var i=a?0:250,c=a?25:250,s=w.length;console.log("currentPosition is "+n);var d=r.getY(u,k),f=r.getX(u,k);k=l(),console.log("card is "+t.rank+" of "+t.suit+", handSize is "+u+", \n              currentY is "+d+" and currentX is "+f),t.animateTo({delay:i,duration:c,y:d,x:f,rot:r.rot,onStart:function(){t.$el.style.zIndex=s-1+u},onComplete:function(){t.setSide(r.side),r.cards.push(t),v++,e()}})})}function i(n){return new Promise(function(n,t){var e=Math.floor(4*Math.random());c=e,s=(e+1)%h.length,n()})}var c,a,s=void 0,d=void 0,f=void 0,h=["west","north","east","south"],p=["spades","hearts","clubs","diamonds"],m={1:{nonTrump:11,trump:11},6:{nonTrump:0,trump:0},7:{nonTrump:0,trump:0},8:{nonTrump:0,trump:0},9:{nonTrump:0,trump:14},10:{nonTrump:10,trump:10},11:{nonTrump:2,trump:20},12:{nonTrump:3,trump:3},13:{nonTrump:4,trump:4}},v=0,g={west:{begOne:-6,endOne:-3,side:"back",getY:function(n,t){return Math.round(10*(n-1.95)*t/16)},getX:function(n,t){return Math.round(-130*t/16)},nextPosition:"north",rot:90,cards:new Array},north:{begOne:-9,endOne:-6,side:"back",getY:function(n,t){return Math.round(-130*t/16)},getX:function(n,t){return Math.round(10*(n-2.45)*t/16)},nextPosition:"east",rot:0,cards:new Array},east:{begOne:-12,endOne:-9,side:"back",getY:function(n,t){return Math.round(10*(n-1.95)*t/16)},getX:function(n,t){return Math.round(130*t/16)},nextPosition:"south",rot:90,cards:new Array},south:{begOne:-15,endOne:-12,side:"front",getY:function(n,t){return Math.round(180*t/16)},getX:function(n,t){return Math.round(25*(n-3.75)*t/16)},nextPosition:"west",rot:0,cards:new Array}};return{getDealer:function(){return h[c]},getCurrent:function(){return h[s]},start:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];return a=t,i().then(function(n){return r(3,4)}).then(function(n){return r(3,4)}).then(function(t){return n()}).then(function(n){return console.log("bid is "+n),r(3,4)}).then(function(n){return"finished deal, trump is "+d+", bid by "+f})}}}();n.tarabish=n.queued(t),n.test=n.queued(e)},card:function(n){n.$el}},$={deck:function(n){function t(t){var e=n.cards,o=e.length;M=l(),e.slice(-5).reverse().forEach(function(n,e){n.poker(e,o,function(e){n.setSide("front"),4===e&&t()})})}n.poker=n.queued(t)},card:function(n){var t=n.$el;n.poker=function(e,o,r){var u=250*e;n.animateTo({delay:u,duration:250,x:Math.round(70*(e-2.05)*M/16),y:Math.round(-110*M/16),rot:0,onStart:function(){t.style.zIndex=o-1+e},onComplete:function(){r(e)}})}}},D={deck:function(t){function e(e){var o=t.cards;o.forEach(function(t,r){t.setSide("front"),t.intro(r,function(r){n(250,0).start(function(){t.setSide("back")}),r===o.length-1&&e()})})}t.intro=t.queued(e)},card:function(n){var t=e("transform"),r=n.$el;n.intro=function(e,u){var i=500+10*e,c=e/4;r.style[t]=o(-c+"px","-250px"),r.style.opacity=0,n.x=-c,n.y=-250-c,n.rot=0,n.animateTo({delay:i,duration:1e3,x:-c,y:-c,onStart:function(){r.style.zIndex=e},onProgress:function(n){r.style.opacity=n},onComplete:function(){r.style.opacity="",u&&u(e)}})}}},X={deck:function(n){function t(t){var e=n.cards,o=e.length;q=l(),e.forEach(function(n,r){n.fan(r,o,function(n){n===e.length-1&&t()})})}n.fan=n.queued(t)},card:function(n){var t=n.$el;n.fan=function(e,o,r){var u=e/4,i=10*e,c=e/(o-1)*260-130;n.animateTo({delay:i,duration:300,x:-u,y:-u,rot:0}),n.animateTo({delay:300+i,duration:300,x:55*Math.cos(h(c-90))*q/16,y:55*Math.sin(h(c-90))*q/16,rot:c,onStart:function(){t.style.zIndex=e},onComplete:function(){r(e)}})}}},Y={deck:function(n){function t(t){var e=n.cards;S=l(),e.forEach(function(n){n.bysuit(function(n){n===e.length-1&&t()})})}n.bysuit=n.queued(t)},card:function(n){var t=n.rank,e=n.suit;n.bysuit=function(o){var r=n.i,u=10*r;n.animateTo({delay:u,duration:400,x:-Math.round(8*(6.75-t)*S/16),y:-Math.round(92*(1.5-e)*S/16),rot:0,onComplete:function(){o(r)}})}}};return v.animationFrames=n,v.ease=O,v.modules={bysuit:Y,fan:X,intro:D,poker:$,tarabish:z,shuffle:E,sort:A,flip:I},v.Card=i,v.prefix=e,v.translate=o,v}();